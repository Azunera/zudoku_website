<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku</title>
    <style>
        #sudoku-container {
            position: relative;
            width: 450px;
            height: 450px;
        }

        #sudoku-canvas {
            width: 100%;
            height: 100%;
        }

        .sudoku-number {
            position: absolute;
            font-family: 'Dancing Script', cursive;
            font-size: 24px;
            text-align: center;
            line-height: 50px; /* Match the cell size for centering */
        }
    </style>
    <!-- Include the font -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
</head>
<body>
    <div id="sudoku-container">
        <canvas id="sudoku-canvas" width="450" height="450"></canvas>
    </div>
    <script src="path/to/zudoku_class.js"></script>
    <script src="path/to/saveLoad.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('sudoku-container');
            const canvas = document.getElementById('sudoku-canvas');
            const ctx = canvas.getContext('2d');
            const cellSize = canvas.width / 9;
            let selectedCell = null;

            let sudoku = new Sudoku();
            sudoku.generateSudoku();
            sudoku.setDifficulty('Medium');

            function drawGrid() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = sudoku.color;

                for (let i = 0; i <= 9; i++) {
                    ctx.lineWidth = (i % 3 === 0) ? 2 : 0.5;
                    ctx.beginPath();
                    ctx.moveTo(i * cellSize, 0);
                    ctx.lineTo(i * cellSize, canvas.height);
                    ctx.moveTo(0, i * cellSize);
                    ctx.lineTo(canvas.width, i * cellSize);
                    ctx.stroke();
                }
            }

            function drawNumbers() {
                // Clear previous numbers
                const oldNumbers = document.getElementsByClassName('sudoku-number');
                while (oldNumbers[0]) {
                    oldNumbers[0].parentNode.removeChild(oldNumbers[0]);
                }

                // Add new numbers
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        const num = sudoku.sudoku[row][col];
                        if (num) {
                            const numberDiv = document.createElement('div');
                            numberDiv.className = 'sudoku-number';
                            numberDiv.textContent = num;
                            numberDiv.style.color = 'yellow'; // Set text color
                            numberDiv.style.width = `${cellSize}px`;
                            numberDiv.style.height = `${cellSize}px`;
                            numberDiv.style.left = `${col * cellSize}px`;
                            numberDiv.style.top = `${row * cellSize}px`;
                            container.appendChild(numberDiv);
                        }
                    }
                }
            }

            function handleClick(event) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                const col = Math.floor(x / cellSize);
                const row = Math.floor(y / cellSize);
                selectedCell = { row, col };
            }

            function insert_number(num) {
                if (sudoku.lives >  0) {
                    if (selectedCell && num >= "1" && num <= "9") {
                        const { row, col } = selectedCell;
                        if (sudoku.sudoku[row][col] == num) {
                            sudoku.sudoku[row][col] = ' ';
                        } else {
                            sudoku.sudoku[row][col] = num;
                            if (!sudoku.check_cell(row, col)) {
                                sudoku.lives -= 1;
                                document.getElementById('lives_label').innerHTML = `${sudoku.lives} lives left`;
                            }
                        }
                        drawGrid();
                        drawNumbers();
                    }
                }
            }

            function handleKeyPress(event) {
                insert_number(event.key);
            }

            canvas.addEventListener('click', handleClick);
            document.addEventListener('keypress', handleKeyPress);

            drawGrid();
            drawNumbers();

            document.getElementById('save').addEventListener('click', () => {
                saveSudoku(sudoku);
            });

            document.getElementById('load').addEventListener('click', async () => {
                await loadSudoku(sudoku);
                drawGrid();
                drawNumbers();
            });

            document.querySelectorAll('.difficulty_button').forEach(button => {
                button.addEventListener('click', (event) => {
                    sudoku.generateSudoku();
                    sudoku.setDifficulty(event.target.textContent);
                    drawGrid();
                    drawNumbers();
                });
            });

            let number_buttons = document.getElementsByClassName('number_button');
            for (let i = 0; i < number_buttons.length; i++)
                number_buttons[i].addEventListener('click', (event) => {
                    insert_number(event.target.textContent);
                });

            const dropdownButton = document.getElementById('dropdownButton');
            const dropdownContent = document.getElementById('dropdownContent');
            const options = document.querySelectorAll('.option');

            dropdownButton.addEventListener('click', () => {
                dropdownContent.style.display = 'block';
            });

            options.forEach(option => {
                option.addEventListener('click', (event) => {
                    const value = option.getAttribute('data-value');
                    setTheme(value);
                    dropdownButton.innerHTML = event.target.textContent;
                    dropdownContent.classList.remove('show');
                    dropdownContent.style.display = 'none';
                });
            });

            window.addEventListener('click', (e) => {
                if (!dropdownButton.contains(e.target) && !dropdownContent.contains(e.target)) {
                    dropdownContent.style.display = 'none';
                }
            });

            function setTheme(value) {
                document.body.className = '';
                let color = '';
                let color2 = '';
                let hoverColor = '';
                switch (value) {
                    case '1':
                        document.body.classList.add('daylight');
                        hoverColor = '#ddd';
                        sudoku.color = '#000';
                        drawGrid();
                        drawNumbers();
                        break;
                    case '2':
                        document.body.classList.add('moonlight');
                        color = '#f0e68c';
                        color2 = '#ffffff';
                        sudoku.color = '#f0e68c';
                        drawGrid();
                        drawNumbers();
                        break;
                    case '3':
                        document.body.classList.add('aquatic');
                        color = '#000000';
                        sudoku.color = '#000000';
                        drawGrid();
                        drawNumbers();
                        break;
                    case '4':
                        document.body.classList.add('twilight');
                        color = '#ffe4e1';
                        sudoku.color = '#ffffff';
                        drawGrid();
                        drawNumbers();
                        break;
                }

                document.querySelectorAll('p').forEach(p => {
                    p.style.color = color;
                });

                document.querySelector('h1').style.color = color;
                document.querySelector('label').style.color = color2;
                document.getElementById('dropdownButton').style.color = color2;

                document.querySelectorAll('.option').forEach(style_option => {
                    style_option.style.color = color2;
                });

                document.querySelectorAll('.number_button').forEach(button => {
                    button.style.color = color2;
                });

                document.querySelectorAll('.bottom_buttons').forEach(button => {
                    button.style.color = color2;
                });

                document.querySelectorAll('.difficulty_button').forEach(button => {
                    button.style.color = color2;
                });
            }

            welcomeLogin();
        });
    </script>
</body>
</html>
